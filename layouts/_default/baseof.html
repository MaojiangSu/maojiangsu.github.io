{{- if lt hugo.Version "0.147.2" }}
{{- errorf "=> hugo v0.147.2 or greater is required for hugo-PaperMod to build " }}
{{- end -}}

<!DOCTYPE html>
<html lang="{{ site.Language }}" dir="{{ .Language.LanguageDirection | default "auto" }}">

<head>
    {{- partial "head.html" . }}

    {{ if .IsPage }}
      <!-- Google Scholar / Highwire metadata (safe, no .Authors/.Author) -->

      <!-- Title -->
      <meta name="citation_title" content="{{ .Title | html }}">

      <!-- Authors: try author/authors via .Param; normalize to slice -->
      {{ $rawAuthors := or (.Param "author") (.Param "authors") }}
      {{ if $rawAuthors }}
        {{ $authors := cond (reflect.IsSlice $rawAuthors) $rawAuthors (slice $rawAuthors) }}
        {{ range $authors }}
          {{ if (reflect.IsMap .) }}
            {{ with .name }}<meta name="citation_author" content="{{ . | html }}">{{ end }}
            {{ with .Name }}<meta name="citation_author" content="{{ . | html }}">{{ end }}
          {{ else }}
            <meta name="citation_author" content="{{ . | html }}">
          {{ end }}
        {{ end }}
      {{ end }}

      <!-- Publication date: PublishDate -> Date -> Param "date" -->
      {{ $pdate := or .PublishDate (or .Date (.Param "date")) }}
      {{ with $pdate }}
        <meta name="citation_publication_date" content="{{ .Format "2006/01/02" }}">
      {{ end }}

      <!-- Venue: conference / journal / booktitle / editPost.Text -->
      {{ if (.Param "conference") }}
        <meta name="citation_conference_title" content="{{ (.Param "conference") | html }}">
      {{ else if (.Param "journal") }}
        <meta name="citation_journal_title" content="{{ (.Param "journal") | html }}">
      {{ else if (.Param "booktitle") }}
        <meta name="citation_conference_title" content="{{ (.Param "booktitle") | html }}">
      {{ else }}
        {{ with (.Param "editPost") }}
          {{ with .Text }}<meta name="citation_conference_title" content="{{ . | html }}">{{ end }}
        {{ end }}
      {{ end }}

      <!-- PDF URL: pdf -> pdf_url -> pdf_file -> paper -> page resource -->
      {{ if (.Param "pdf") }}
        <meta name="citation_pdf_url" content="{{ (.Param "pdf") }}">
      {{ else if (.Param "pdf_url") }}
        <meta name="citation_pdf_url" content="{{ (.Param "pdf_url") }}">
      {{ else if (.Param "pdf_file") }}
        <meta name="citation_pdf_url" content="{{ printf "%s%s" site.BaseURL (.Param "pdf_file") }}">
      {{ else if (.Param "paper") }}
        <meta name="citation_pdf_url" content="{{ (.Param "paper") }}">
      {{ else }}
        {{ with .Resources.GetMatch "**/*.pdf" }}
          <meta name="citation_pdf_url" content="{{ .Permalink }}">
        {{ end }}
      {{ end }}

      <!-- Optional IDs -->
      {{ with (.Param "doi") }}<meta name="citation_doi" content="{{ . }}">{{ end }}
      {{ with (or (.Param "arxiv") (.Param "arXiv")) }}<meta name="citation_arxiv" content="{{ . }}">{{ end }}
    {{ end }}
</head>

<body class="
{{- if (or (ne .Kind `page` ) (eq .Layout `archives`) (eq .Layout `search`)) -}}
{{- print "list" -}}
{{- end -}}
{{- if eq site.Params.defaultTheme `dark` -}}
{{- print " dark" }}
{{- end -}}
" id="top">
    {{- if not .IsHome  }}
    {{- partialCached "header.html" . .Page -}}
    {{- end }}
    <main class="main">
        {{- block "main" . }}{{ end }}
    </main>
    {{ partialCached "footer.html" . .Layout .Kind (.Param "hideFooter") (.Param "ShowCodeCopyButtons") -}}
</body>
</html>
